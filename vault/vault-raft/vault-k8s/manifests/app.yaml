apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
  namespace: vault
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      annotations:
       vault.hashicorp.com/agent-inject: 'true'
       vault.hashicorp.com/role: 'test-role'
       vault.hashicorp.com/agent-inject-secret-password.txt: 'test/secret'
      # Annotations for k8s auth method auto-auth
       vault.hashicorp.com/auth-path: auth/kubernetes
       vault.hashicorp.com/auth-type: kubernetes
      labels:
        app: nginx
    spec:
      serviceAccountName: test-sa
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
